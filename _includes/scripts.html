<script>
    function updateClock() {
        const now = new Date();
        const timeEl = document.getElementById('clock-time');
        const dateEl = document.getElementById('clock-date');
        const lunarEl = document.getElementById('clock-lunar');
        if(timeEl) timeEl.textContent = now.toLocaleTimeString('zh-CN', { hour12: false });
        if(dateEl) dateEl.textContent = now.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
        try {
            if(lunarEl) {
                const lunar = new Intl.DateTimeFormat('zh-u-ca-chinese', {day:'numeric', month:'long'}).format(now);
                lunarEl.textContent = "农历 " + lunar;
            }
        } catch(e) {}
    }
    setInterval(updateClock, 1000); updateClock();

    function loadHistory() {
        const container = document.getElementById('history-content');
        if (container && window.siteData && window.siteData.history) {
            container.innerHTML = window.siteData.history.map(item => 
                `<div class="history-item"><span class="history-year" style="color: var(--primary-color); font-weight: bold;">${item.year}</span><br>${item.event}</div>`
            ).join('');
        }
    }
    window.addEventListener('DOMContentLoaded', () => {
        loadHistory();
        loadAnimeExtras();
        if (typeof loadBangumiWiki === 'function') loadBangumiWiki();
    });
</script>
