<div class="extra-box glass-card search-box-card">
    <div class="extra-title"><i class="fas fa-search"></i> å…¨ç«™æœç´¢</div>
    <div class="search-wrapper">
        <input type="text" id="search-input" placeholder="å°‘å¥³æœç´¢ä¸­...">
        <ul id="results-container"></ul>
    </div>
</div>

<div class="extra-box glass-card clock-box">
    <div id="clock-time">00:00:00</div>
    <div id="clock-date"></div>
    <div id="clock-lunar"></div>
</div>

<!-- ä»…åœ¨é¦–é¡µæˆ–ç‰¹å®šé¡µé¢æ˜¾ç¤ºå†å²è®°å½• -->
{% if page.url == "/" or page.url == "/index.html" %}
<div class="extra-box glass-card">
    <div class="extra-title"><i class="fas fa-history"></i> å†å²ä¸Šçš„ä»Šå¤©</div>
    <div id="history-content" style="max-height: 350px; overflow-y: auto; color: var(--text-main);">è½½å…¥ä¸­...</div>
</div>
{% endif %}

<!-- åŠ¨æ¼«åˆ†ç±»é¡µï¼šæ˜¾ç¤ºè¿½ç•ª -->
{% if page.url contains '/categories/anime' %}
<div class="extra-box glass-card">
    <div class="extra-title"><i class="fas fa-play-circle"></i> æ­£åœ¨è¿½ç•ª (Watching)</div>
    <ul style="list-style: none; padding: 0; margin: 0; font-size: 0.85em; color: var(--text-main);">
        {% for item in site.data.me.anime.watching %}
        <li style="margin-bottom: 8px; border-left: 3px solid #f09199; padding-left: 10px;">{{ item }}</li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<!-- éŸ³ä¹åˆ†ç±»é¡µï¼šæ˜¾ç¤ºç¤¾å›¢ä¸æ›²é£ -->
{% if page.url contains '/categories/music' %}
<div class="extra-box glass-card">
    <div class="extra-title"><i class="fas fa-compact-disc"></i> å…³æ³¨ç¤¾å›¢ (Circle)</div>
    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
        {% for item in site.data.me.music.circles %}
        <span style="background: rgba(74, 144, 226, 0.1); color: #4a90e2; padding: 4px 10px; border-radius: 8px; font-size: 0.75em; border: 1px solid rgba(74, 144, 226, 0.2);">{{ item }}</span>
        {% endfor %}
    </div>
    <div class="extra-title" style="margin-top: 20px;"><i class="fas fa-headphones-simple"></i> æ›²é£åå¥½ (Genre)</div>
    <div style="font-size: 0.85em; color: var(--text-main); line-height: 1.8;">
        {% for item in site.data.me.music.genres %}
        <span style="margin-right: 12px;"><i class="fas fa-hashtag" style="font-size: 0.8em; color: var(--text-muted);"></i> {{ item }}</span>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- æ¸¸æˆåˆ†ç±»é¡µï¼šæ˜¾ç¤ºé…ç½® -->
{% if page.url contains '/categories/game' %}
<div class="extra-box glass-card">
    <div class="extra-title"><i class="fas fa-tower-pc"></i> ç³»ç»Ÿé…ç½® (Specs)</div>
    <div style="font-size: 0.85em; color: var(--text-main);">
        <div style="margin-bottom: 10px;">
            <div style="color: var(--primary-color); font-weight: bold;"><i class="fas fa-microchip"></i> CPU</div>
            <div>{{ site.data.me.game.specs.cpu }}</div>
        </div>
        <div style="margin-bottom: 10px;">
            <div style="color: #f09199; font-weight: bold;"><i class="fas fa-video"></i> GPU</div>
            <div>{{ site.data.me.game.specs.gpu }}</div>
        </div>
        <div style="margin-bottom: 10px;">
            <div style="color: var(--text-muted); font-weight: bold;"><i class="fas fa-memory"></i> RAM</div>
            <div>{{ site.data.me.game.specs.ram }}</div>
        </div>
        <div>
            <div style="color: var(--primary-color); font-weight: bold;"><i class="fas fa-hard-drive"></i> Storage</div>
            <div>{{ site.data.me.game.specs.storage }}</div>
        </div>
    </div>
</div>
{% endif %}

<!-- snapåˆ†ç±»é¡µï¼šæ˜¾ç¤ºè£…å¤‡ -->
{% if page.url contains '/categories/snap' %}
<div class="extra-box glass-card">
    <div class="extra-title"><i class="fas fa-tower-pc"></i> è£…å¤‡ (equipment)</div>
    <div style="font-size: 0.85em; color: var(--text-main);">
        <div style="margin-bottom: 10px;">
            <div style="color: var(--primary-color); font-weight: bold;"><i class="fas fa-camera"></i> Camera</div>
            <div>{{ site.data.me.snap.equipment.camera }}</div>
        </div>
        <div style="margin-bottom: 10px;">
            <div style="color: #f09199; font-weight: bold;"><i class="fas fa-dot-circle"></i> Lens</div>
            <div>{{ site.data.me.snap.equipment.lens }}</div>
    </div>
</div>
{% endif %}

<!-- æ¯æ—¥å£°ä¼˜æ¨è -->
{% if page.url contains '/categories/anime' %}
<div class="extra-box glass-card">
    <div class="extra-title"><i class="fas fa-microphone-lines"></i> å£°ä¼˜åé‰´ Â· æ¯æ—¥æ¨è</div>
    <div id="cv-content">
        <h4 id="cv-name" style="color: var(--primary-color); margin: 0 0 5px 0;"></h4>
        <div id="cv-meta" style="font-size: 0.75em; color: var(--text-muted); margin-bottom: 10px;">
            <span id="cv-agency" style="margin-right: 10px;"></span>
            <span id="cv-hometown"></span>
        </div>
        <p id="cv-works" style="font-size: 0.85em; color: var(--text-main); margin-bottom: 8px; font-weight: bold;"></p>
        <p id="cv-intro" style="font-size: 0.85em; color: var(--text-main); line-height: 1.5; border-top: 1px dashed var(--glass-border); padding-top: 8px; margin-bottom: 12px;"></p>
        <a id="cv-wiki-link" href="#" target="_blank" class="moe-btn">æŸ¥çœ‹èŒå¨˜ç™¾ç§‘ ğŸ“–</a>
    </div>
</div>
{% endif %}

<!-- åŠ¨æ¼«æ–‡ç« è¯¦æƒ…é¡µ -->
{% if page.layout == 'post' and page.categories contains 'anime' %}
<div class="extra-box glass-card anime-info-card">
    <div class="extra-title"><i class="fas fa-circle-info"></i> åŠ¨æ¼«ç™¾ç§‘</div>
    <div id="anime-wiki-content">
        <h4 id="wiki-title" style="color: var(--primary-color); margin: 0 0 10px 0;"></h4>
        <p id="wiki-desc" style="font-size: 0.85em; line-height: 1.5; color: var(--text-main); margin-bottom: 15px;"></p>
        <a id="wiki-bgm-link" href="#" target="_blank" class="bgm-btn">åœ¨ Bangumi æŸ¥çœ‹ ğŸ“º</a>
    </div>
</div>

<script>
    function loadBangumiWiki() {
        const wikiTitle = document.getElementById('wiki-title');
        const wikiBgmLink = document.getElementById('wiki-bgm-link');
        const wikiDesc = document.getElementById('wiki-desc');
        if (!wikiTitle || !wikiBgmLink) return;

        let animeName = "";
        
        // 1. å°è¯•ä»æ ‡ç­¾ä¸­æå– 
        const tagContainer = document.getElementById('data-post-tags');
        if (tagContainer) {
            const tags = tagContainer.textContent.split(',');
            const skip = ['åŠ¨æ¼«', 'äºŒæ¬¡å…ƒ', 'æ‹çˆ±ç•ª', 'çƒ­è¡€ç•ª', 'æˆé•¿', 'æ¼«è¯„', 'æ„Ÿæƒ³', 'ç•ªå‰§', 'é’æ˜¥', 'æ²»æ„ˆ', 'ç§‘å¹»', 'æ‚¬ç–‘', 'æ—¥å¸¸', 'æ ¡å›­', 'å¥‡å¹»', 'æˆ˜æ–—', '3Då½¼å¥³', 'å›¾åƒ', 'ç»˜ç”»', 'éšç¬”'];
            const generalTags = ['åŠ¨æ¼«', 'æ‹çˆ±ç•ª', 'çƒ­è¡€ç•ª', 'æˆé•¿', 'æ¼«è¯„', 'æ„Ÿæƒ³', 'ç•ªå‰§', 'é’æ˜¥', 'æ²»æ„ˆ', 'ç§‘å¹»', 'æ‚¬ç–‘', 'æ—¥å¸¸', 'æ ¡å›­', 'å¥‡å¹»', 'æˆ˜æ–—', 'å›¾åƒ', 'ç»˜ç”»', 'éšç¬”', 'æ–°å¹´'];
            
            for (let t of tags) {
                let cleanT = t.trim();
                if (cleanT && !generalTags.includes(cleanT)) {
                    animeName = cleanT;
                    break;
                }
            }
        }

        // 2. å¦‚æœæ ‡ç­¾æ²¡æå–åˆ°ï¼Œä»æ ‡é¢˜æå–
        if (!animeName) {
            let title = "{{ page.title }}";
            // å»æ‰å¸¸è§çš„åç¼€å¦‚ "æ„Ÿæƒ³", "æ¼«è¯„", "è§‚åæ„Ÿ"
            animeName = title.replace(/(æ„Ÿæƒ³|æ¼«è¯„|è§‚åæ„Ÿ|è®°å½•|éšç¬”)$/, "").trim();
        }

        if (animeName) {
            wikiTitle.textContent = animeName;
            wikiBgmLink.href = "https://bgm.tv/subject_search?search_text=" + encodeURIComponent(animeName) + "&cat=2";
            wikiDesc.textContent = "ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åœ¨ Bangumi æŸ¥çœ‹å…³äºã€Š" + animeName + "ã€‹çš„è¯¦ç»†è¯„åˆ†ä¸èµ„è®¯ã€‚";
        }
    }
    // ç«‹å³å°è¯•æ‰§è¡Œä¸€æ¬¡ï¼Œæ³¨å†Œåˆ° DOMContentLoaded å…œåº•
    loadBangumiWiki();
</script>
{% endif %}

<style>
    .moe-btn { display: inline-block; background: var(--primary-color); color: white !important; padding: 6px 12px; border-radius: 8px; text-decoration: none; font-size: 0.8em; font-weight: bold; transition: 0.3s; }
    .moe-btn:hover { filter: brightness(1.1); transform: scale(1.05); }
    .bgm-btn { display: inline-block; background: #f09199; color: white !important; padding: 6px 12px; border-radius: 8px; text-decoration: none; font-size: 0.8em; font-weight: bold; transition: 0.3s; }
    .bgm-btn:hover { filter: brightness(1.1); transform: scale(1.05); }
</style>
